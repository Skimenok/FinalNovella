const textEl = document.getElementById("text");
const choicesEl = document.getElementById("choices");
const bgA = document.getElementById("bg");
const bgB = document.getElementById("bg2");
const charImg = document.getElementById("charImg");
const typeSound = document.getElementById("typeSound");
const clickSound = document.getElementById("clickSound");
const startScreen = document.getElementById("startScreen");
const startBtn = document.getElementById("startBtn");
const skipBtn = document.getElementById("skipBtn");

const TYPING_SPEED = 40;
let audioAllowed = false;
let skipRequested = false;
let gameStartTime = null; 
let currentBg = 1; 
let GAME_STATE = {
  hearts: 4,
};

const scenes = {
  scene1: {
    bg: "backgrounds/1.1.jpg",
    char: "",
    text: "–¢–∞–∫, –ª–∞–¥–Ω–æ. –ï—â–µ –æ–¥–∏–Ω —Ñ–∏–∫—Å –¥–ª—è —Ñ—É—Ç–µ—Ä–∞, –∏ –º–æ–∂–Ω–æ —Å–ø–∞—Ç—å... –•–æ—Ç—è –∫–æ–≥–æ —è –æ–±–º–∞–Ω—ã–≤–∞—é? –ó–∞–∫–∞–∑—á–∏–∫ –ø—Ä–∏—à–ª–µ—Ç –ø—Ä–∞–≤–∫–∏ –≤ 8 —É—Ç—Ä–∞.\n\n–ó–≤—É–∫ –≥–ª–æ—Ç–∫–∞ –∫–æ—Ñ–µ.\n\n–•–æ–ª–æ–¥–Ω—ã–π. –í–∫—É—Å –∂–∂–µ–Ω–æ–π —Ä–µ–∑–∏–Ω—ã –∏ –±–µ–∑—ã—Å—Ö–æ–¥–Ω–æ—Å—Ç–∏. –ò–¥–µ–∞–ª—å–Ω–æ.\n\n–°–µ—Ä–µ–∂–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12).\n\n–î–∞ –≥–¥–µ –∂–µ —ç—Ç–∞ –æ—à–∏–±–∫–∞?.. –¢–∞–∫, body, div, main-container... –°—Ç–æ–ø. –≠—Ç–æ –µ—â–µ —á—Ç–æ?\n\n–ù–∞ —ç–∫—Ä–∞–Ω–µ: –°—Ä–µ–¥–∏ –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ –∂–µ–ª—Ç—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—É–ª—å—Å–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞. –¢–µ–∫—Å—Ç –ø–µ—Ä–µ–ª–∏–≤–∞–µ—Ç—Å—è, –±—É–¥—Ç–æ –æ–Ω –∂–∏–≤–æ–π.\n\nSYSTEM_STATUS: CRITICAL.\nSOUL_CAPACITY: 1%.\nINITIATE_REBOOT? [Y/N]\n\n–ï–º–∫–æ—Å—Ç—å –¥—É—à–∏: 1%? –û—á–µ–Ω—å —Å–º–µ—à–Ω–æ, –ú–∞–∫—Å. –û–ø—è—Ç—å —Å–≤–æ–∏ —Å–∫—Ä–∏–ø—Ç—ã –º–Ω–µ –≤ –ø—Ä–æ–µ–∫—Ç –ø–æ–¥—Å—É–Ω—É–ª?",
    choices: [
      {
        text: "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –∏ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å.",
        next: "skepticism",
      },
      { text: "–•—É–∂–µ —É–∂–µ –Ω–µ –±—É–¥–µ—Ç. –í–≤–µ—Å—Ç–∏ Y.", next: "reboot" },
      {
        text: "–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞–π—Ç–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.",
        next: "analysis",
      },
    ],
  },
  skepticism: {
    bg: "backgrounds/1.1.jpg",
    char: "",
    text: "–£ –º–µ–Ω—è –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–∞—Å—Ö–∞–ª–∫–∏. –î–µ–¥–ª–∞–π–Ω –≥–æ—Ä–∏—Ç.\n\n(–ù–∞–∂–∏–º–∞–µ—Ç –∫—Ä–µ—Å—Ç–∏–∫. –û–∫–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è. –°–æ–æ–±—â–µ–Ω–∏–µ –º–∏–≥–∞–µ—Ç —è—Ä—á–µ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–∑–¥–∞–≤–∞—Ç—å –Ω–∏–∑–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã–π –≥—É–ª).\n\n–î–∞ –≤—ã –∏–∑–¥–µ–≤–∞–µ—Ç–µ—Å—å... –õ–∞–¥–Ω–æ. –•–æ—á–µ—à—å —Ä–µ–±—É—Ç? –ü–æ–ª—É—á–∞–π.",
    choices: [{ text: "–í–≤–µ—Å—Ç–∏ Y", next: "reboot" }],
  },
  analysis: {
    bg: "backgrounds/1.1.jpg",
    char: "",
    text: "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –ö–∞–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —ç—Ç–æ –º–µ—Ç–æ–¥? React? Vue? –ò–ª–∏ —á—Ç–æ-—Ç–æ —Å–∞–º–æ–ø–∏—Å–Ω–æ–µ?\n\n(–ü—ã—Ç–∞–µ—Ç—Å—è –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ —Ñ–∞–π–ª–∞. –°—Å—ã–ª–∫–∞ –≤–µ–¥–µ—Ç –≤ null)\n\n–ù–∏–∫–∞–∫–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –ü—Ä—è–º–æ –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞? –õ–∞–¥–Ω–æ, –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏–ª–æ.",
    choices: [{ text: "–í–≤–µ—Å—Ç–∏ Y", next: "reboot" }],
  },
  reboot: {
    bg: "backgrounds/1.1.jpg",
    char: "",
    text: "(–°–µ—Ä–µ–∂–∞) (–ø–µ—á–∞—Ç–∞–µ—Ç):\n¬´Y¬ª.\n¬´Enter¬ª.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "immersion" }],
  },
  immersion: {
    bg: "backgrounds/1.2.jpg",
    char: "",
    text: '–û—Ñ–∏—Å –∏—Å–∫–∞–∂–∞–µ—Ç—Å—è. –¶–≤–µ—Ç–∞ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è. –ú–æ–Ω–∏—Ç–æ—Ä "—Å—Ç–µ–∫–∞–µ—Ç" –Ω–∞ —Å—Ç–æ–ª.\n\n–ó–≤—É–∫: –ì–ª–∏—Ç—á-—ç—Ñ—Ñ–µ–∫—Ç—ã, –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–π —Ü–∏—Ñ—Ä–æ–≤–æ–π —à—É–º, –∑–≤—É–∫ –±–∏—Ç–æ–≥–æ —Å—Ç–µ–∫–ª–∞.\n\n–ß—Ç–æ –∑–∞... –í–∏–¥–µ–æ–∫–∞—Ä—Ç–∞ —Å–≥–æ—Ä–µ–ª–∞? –ß–µ—Ä—Ç, —Ç–æ–ª—å–∫–æ –Ω–µ —Å–µ–π—á–∞—Å, —É –º–µ–Ω—è –Ω–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –Ω–æ–≤...\n\n–≠–∫—Ä–∞–Ω –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç –æ—Å–ª–µ–ø–∏—Ç–µ–ª—å–Ω—ã–º —Å–≤–µ—Ç–æ–º. –†—É–∫–∏ –°–µ—Ä–µ–∂–∏ –Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞—Å–ø–∞–¥–∞—Ç—å—Å—è –Ω–∞ –ø–∏–∫—Å–µ–ª–∏.\n\n–Ø... –Ø –Ω–µ —á—É–≤—Å—Ç–≤—É—é —Ä—É–∫! –ö–∞–∫–æ–≥–æ —Ö—Ä–µ–Ω–∞?!\n\n–¢–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ (–º—ã—Å–ª–∏):\n–ú–ï–ù–Ø. –¢–Ø–ù–ï–¢. –í–ù–£–¢–†–¨.\n\n–ß–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω. –¢–∏—à–∏–Ω–∞.\n\n...\n\n–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ. –¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–µ –Ω–µ–±–æ —Å –±–µ–≥—É—â–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ –¥–≤–æ–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞. –ü–æ–¥ –Ω–æ–≥–∞–º–∏ ‚Äî –ø–∞—Ä—è—â–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏–∑ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ —Å—Ç–µ–∫–ª–∞. –í–æ–∫—Ä—É–≥ –ª–µ—Ç–∞—é—Ç –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–µ —Å–∫–æ–±–∫–∏ { } –∏ –æ–±—Ä—ã–≤–∫–∏ —Ç–µ–≥–æ–≤ <div>.\n\n(–°–µ—Ä–µ–∂–∞) (–º–µ–¥–ª–µ–Ω–Ω–æ –≤—Å—Ç–∞–µ—Ç, –¥–µ—Ä–∂–∞—Å—å –∑–∞ –≥–æ–ª–æ–≤—É):\n–ì–æ–ª–æ–≤–∞ —Ä–∞—Å–∫–∞–ª—ã–≤–∞–µ—Ç—Å—è... –≠—Ç–æ —Å–æ–Ω? –Ø –∑–∞—Å–Ω—É–ª –Ω–∞ –∫–ª–∞–≤–µ?\n\n(–°–º–æ—Ç—Ä–∏—Ç –≤–Ω–∏–∑)\n–Ø —Å—Ç–æ—é –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ... –≤–∏—Å—è—â–µ–π –≤ –Ω–∏–≥–¥–µ. –ê –≤–æ–Ω —Ç–æ –æ–±–ª–∞–∫–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫—É—Å–æ–∫ CSS-—Å—Ç–∏–ª—è overflow: hidden. –û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏—Ö–æ–¥, –°–µ—Ä–µ–∂–∞. –ü–æ—Ä–∞ –∑–∞–≤—è–∑—ã–≤–∞—Ç—å —Å –∫–æ—Ñ–µ.',
    choices: [
      { text: "–ó–∞–∫—Ä–∏—á–∞—Ç—å –∏ –ø–æ–∑–≤–∞—Ç—å –Ω–∞ –ø–æ–º–æ—â—å.", next: "shout" },
      { text: "–ü–æ–¥–æ–π—Ç–∏ –∫ –∫—Ä–∞—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.", next: "edge" },
    ],
  },
  shout: {
    bg: "backgrounds/1.2.jpg",
    char: "",
    text: "–≠–ô! –ö–¢–û-–ù–ò–ë–£–î–¨! –ú–ê–ö–°! –ù–ê–ß–ê–õ–¨–ù–ò–ö! –Ø –£–í–û–õ–¨–ù–Ø–Æ–°–¨!",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "meeting" }],
  },
  edge: {
    bg: "backgrounds/1.2.jpg",
    char: "",
    text: "–í—ã—Å–æ—Ç–∞... –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è. –í–Ω–∏–∑—É —Ç–æ–ª—å–∫–æ —Ç–µ–º–Ω–æ—Ç–∞ –∏... —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã?",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "meeting" }],
  },
  meeting: {
    bg: "backgrounds/1.2.jpg",
    char: "img/gpt.svg",
    text: '–í–æ–∑–¥—É—Ö –ø–µ—Ä–µ–¥ –°–µ—Ä–µ–∂–µ–π –Ω–∞—á–∏–Ω–∞–µ—Ç –º–µ—Ä—Ü–∞—Ç—å. –ü–æ–ª–∏–≥–æ–Ω—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—É—é, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–µ–Ω—è—é—â—É—é—Å—è —Ñ–æ—Ä–º—É (—à–∞—Ä, –∫—É–±, –ø–∏—Ä–∞–º–∏–¥–∞).\n\n(???):\n–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û–±—ä–µ–∫—Ç: –°–µ—Ä–≥–µ–π. –°—Ç–∞—Ç—É—Å: –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω.\n\n(–°–µ—Ä–µ–∂–∞):\n–¢—ã –∫—Ç–æ —Ç–∞–∫–æ–π? –ì–ª—é–∫? –í–∏—Ä—É—Å?\n\n(–≠–•–û):\n–Ø ‚Äî –≠–•–û. –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —ç—Ç–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –°–µ—Ä–≥–µ–π.\n\n(–§–æ—Ä–º–∞ –≠–•–û –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç —Å —Å–∏–Ω–µ–≥–æ –Ω–∞ —Ç—Ä–µ–≤–æ–∂–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π)\n\n(–≠–•–û):\n–¢—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –ø—Ä–æ—Ç–æ–∫–æ–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è. –¢–≤–æ—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞... —Ç–æ, —á—Ç–æ –≤—ã –Ω–∞–∑—ã–≤–∞–µ—Ç–µ "–∂–∏–∑–Ω—å"... –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞ –º—É—Å–æ—Ä–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏. –î–µ–ø—Ä–µ—Å—Å–∏—è. –†—É—Ç–∏–Ω–∞. –ù–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–º–±–∏—Ü–∏–∏. –ö—ç—à –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω.\n\n(–°–µ—Ä–µ–∂–∞):\n–°–ª—É—à–∞–π, –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è —Ñ–∏–≥—É—Ä–∞, –≤–µ—Ä–Ω–∏ –º–µ–Ω—è –≤ –æ—Ñ–∏—Å. –£ –º–µ–Ω—è –¥–µ–¥–ª–∞–π–Ω —á–µ—Ä–µ–∑ 4 —á–∞—Å–∞. –ó–∞–∫–∞–∑—á–∏–∫ –º–µ–Ω—è —É–±—å–µ—Ç.\n\n(–≠–•–û):\n–í —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ç–≤–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ñ–∞—Ç–∞–ª—å–Ω–æ–π –æ—à–∏–±–∫–µ. –¢—ã –∑–¥–µ—Å—å –Ω–µ —Å–ª—É—á–∞–π–Ω–æ.\n\n(–í–æ–∫—Ä—É–≥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤—Å–ø–ª—ã–≤–∞—é—Ç —ç–∫—Ä–∞–Ω—ã —Å –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏ –°–µ—Ä–µ–∂–∏: –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏, –æ–¥–∏–Ω–æ–∫–∏–µ –≤–µ—á–µ—Ä–∞, –ø—É—Å—Ç–æ–π —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫).\n\n(–≠–•–û):\n–ü–æ—Å–º–æ—Ç—Ä–∏. –¢–≤–æ–π –∫–æ–¥ –Ω–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω. –ß—Ç–æ–±—ã –≤—ã–π—Ç–∏, —Ç—ã –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥. –û—á–∏—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—Ç –±–∞–≥–æ–≤.\n\n(–°–µ—Ä–µ–∂–∞):\n–¢—ã —Ö–æ—á–µ—à—å —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ —è –∑–∞—Å—Ç—Ä—è–ª –≤–Ω—É—Ç—Ä–∏... —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—ã–≥–æ—Ä–µ–≤—à–µ–π –ø—Å–∏—Ö–∏–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Å–ª–æ–º–∞–Ω–Ω—ã–π –≤–µ–±-—Å–∞–π—Ç?\n\n(–≠–•–û):\n–ì—Ä—É–±–∞—è –∞–Ω–∞–ª–æ–≥–∏—è, –Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è. return true.',
    choices: [
      {
        text: "–Ø –Ω–µ –±—É–¥—É –∏–≥—Ä–∞—Ç—å –≤ —Ç–≤–æ–∏ –∏–≥—Ä—ã. –ì–¥–µ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞?",
        next: "aggression",
      },
      {
        text: "–û—Ç–ª–∏—á–Ω–æ. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–∞–≤–∫–∏ –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞, —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∫–∏ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –¥—É—à–∏. –¢–ó –µ—Å—Ç—å?",
        next: "irony",
      },
      { text: "–ê –µ—Å–ª–∏ —è –Ω–µ —Å–ø—Ä–∞–≤–ª—é—Å—å? –ß—Ç–æ –±—É–¥–µ—Ç?", next: "fear" },
    ],
  },
  aggression: {
    bg: "backgrounds/1.2.jpg",
    char: "img/gpt.svg",
    text: "(–≠–•–û):\n–ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–º ECHO.exe. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ\n\n(–°–µ—Ä–µ–∂–∞):\n–ß–µ—Ä—Ç–æ–≤—â–∏–Ω–∞...",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "final" }],
  },
  irony: {
    bg: "backgrounds/1.2.jpg",
    char: "img/sm.svg",
    text: "(–≠–•–û):\n(–ú–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –Ω–∞ —Å–º–∞–π–ª–∏–∫ –∏–∑ —Å–∏–º–≤–æ–ª–æ–≤ ASCII) :)\n–¢–ó —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –≤—ã–∂–∏—Ç—å –∏ –ø–∏—Å–∞—Ç—å –∫–æ–¥.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "final" }],
  },
  fear: {
    bg: "backgrounds/1.2.jpg",
    char: "img/gpt.svg",
    text: "(–≠–•–û):\n–¢–æ–≥–¥–∞ —Ç—ã,... –∞ –≤ –ø—Ä–æ—á–µ–º –Ω–µ –≤–∞–∂–Ω–æ. –õ—É—á—à–µ —Ç–µ–±–µ —ç—Ç–æ–≥–æ –Ω–µ –∑–Ω–∞—Ç—å.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "final" }],
  },
  final: {
    bg: "backgrounds/1.2.jpg",
    char: "img/gpt.svg",
    text: "(–≠–•–û):\n–í–Ω–∏–º–∞–Ω–∏–µ. –û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–µ—Ä–≤—ã–π –≤–∏—Ä—É—Å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä. –ü—Ä–∏–≥–æ—Ç–æ–≤—å—Å—è, –°–µ—Ä–≥–µ–π. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è.\n\n–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–¥ –Ω–æ–≥–∞–º–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –¥—Ä–æ–∂–∞—Ç—å. –°–µ—Ä–µ–∂–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –Ω–µ–∑–Ω–∞–∫–æ–º–æ–µ –º–µ—Å—Ç–æ.\n\n(–°–µ—Ä–µ–∂–∞):\n¬´...¬ª.\n\n–ö–û–ù–ï–¶ –ê–ö–¢–ê 1",
    choices: [{ text: "–í–ø–µ—Ä—ë–¥!", next: "act2_level1_start" }],
  },
  // –ê–∫—Ç 2: –£—Ä–æ–≤–µ–Ω—å 1 - –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
  act2_level1_start: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–°–º–æ—Ç—Ä–∏. –≠—Ç–æ —Ç–≤–æ–π –æ–±—ã—á–Ω—ã–π –≤—Ç–æ—Ä–Ω–∏–∫. –¢—ã –±–µ—Ä–µ—à—å –∑–∞–¥–∞—á—É, —Ä–µ—à–∞–µ—à—å –µ–µ, –±–µ—Ä–µ—à—å —Å–ª–µ–¥—É—é—â—É—é. –°–º—ã—Å–ª–∞ –Ω–µ—Ç. –ï—Å—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å.\n\n(–°–µ—Ä–µ–∂–∞):\n–ù–æ —è –¥–µ–ª–∞—é –≤–∞–∂–Ω—ã–µ –≤–µ—â–∏! –Ø —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é —Å–æ—Ñ—Ç –¥–ª—è –±–∞–Ω–∫–æ–≤!\n\n–≠–•–û:\n–î–æ–∫–∞–∂–∏ —Å–≤–æ—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.",
    choices: [{ text: "–í—Å—Ç–∞–≤–∞–π –∑–∞ –ø—É–ª—å—Ç", next: "level1_assemble" }],
  },
  level1_assemble: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–°–æ–±–µ—Ä–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–æ–¥–∞, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –∫–æ–Ω–≤–µ–π–µ—Ä–µ.",
    minigame: {
      type: "assemble",
      data: [
        {
          title: "–°–æ–±–µ—Ä–∏ console.log('–ü—Ä–∏–≤–µ—Ç');",
          blocks: [
            { id: "1", text: "console." },
            { id: "2", text: "log(" },
            { id: "3", text: "'–ü—Ä–∏–≤–µ—Ç'" },
            { id: "4", text: ");" },
          ],
          target: ["1", "2", "3", "4"],
        },
        {
          title: "–°–æ–±–µ—Ä–∏ document.createElement('div')",
          blocks: [
            { id: "1", text: "document." },
            { id: "2", text: "createElement(" },
            { id: "3", text: "'div'" },
            { id: "4", text: ")" },
          ],
          target: ["1", "2", "3", "4"],
        },
        {
          title: "–°–æ–±–µ—Ä–∏ button.addEventListener('click', handler)",
          blocks: [
            { id: "1", text: "button." },
            { id: "2", text: "addEventListener(" },
            { id: "3", text: "'click'," },
            { id: "4", text: "handler" },
            { id: "5", text: ")" },
          ],
          target: ["1", "2", "3", "4", "5"],
        },
        {
          title: "–°–æ–±–µ—Ä–∏ const x = input.value;",
          blocks: [
            { id: "1", text: "const x = " },
            { id: "2", text: "input." },
            { id: "3", text: "value;" },
          ],
          target: ["1", "2", "3"],
        },
        {
          title: "–°–æ–±–µ—Ä–∏ element.textContent = '–ì–æ—Ç–æ–≤–æ';",
          blocks: [
            { id: "1", text: "element." },
            { id: "2", text: "textContent = " },
            { id: "3", text: "'–ì–æ—Ç–æ–≤–æ';" },
          ],
          target: ["1", "2", "3"],
        },
      ],
      next: "level1_response",
    },
    choices: [],
  },
  level1_response: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–ë—ã—Å—Ç—Ä–µ–µ. –ó–∞–∫–∞–∑—á–∏–∫ –∂–¥–µ—Ç. –î–µ–¥–ª–∞–π–Ω —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥. –¢—ã –ø—Ä–æ–ø—É—Å–∫–∞–µ—à—å –±–ª–æ–∫–∏. –¢—ã –ø–ª–æ—Ö–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫?",
    choices: [
      { text: "–ó–∞—Ç–∫–Ω–∏—Å—å! –Ø —Å—Ç–∞—Ä–∞—é—Å—å!", next: "level1_response1" },
      { text: "–î–∞ –ø–æ—à–ª–æ –æ–Ω–æ –≤—Å—ë!", next: "level1_break" },
      {
        text: "–ü–æ—á–µ–º—É –∏—Ö —Ç–∞–∫ –º–Ω–æ–≥–æ?! –û—Ç–∫—É–¥–∞ –æ–Ω–∏ –±–µ—Ä—É—Ç—Å—è?!",
        next: "level1_response3",
      },
    ],
  },
  level1_response1: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ. –ú–∏–Ω—É—Å –∑–¥–æ—Ä–æ–≤—å–µ.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level1_clicker" }],
    onEnter: () => GAME_STATE.hearts--,
  },
  level1_response3: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–ò–∑ —Ç–≤–æ–µ–π –Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∫–∞–∑–∞—Ç—å '–ù–µ—Ç'",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level1_clicker" }],
  },
  level1_break: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ–π–µ—Ä–∞.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level1_hack" }],
  },
  level1_clicker: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–ù–∞–∂–∏–º–∞–π, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏.",
    minigame: {
      type: "clicker",
      data: 30,
      next: "level1_hack",
    },
    choices: [],
  },
  level1_hack: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "(–ú–æ–º–µ–Ω—Ç –≤–∑–ª–æ–º–∞. –°–µ—Ä–µ–∂–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–Ω—Å–æ–ª—å.)\n\n–≠–•–û:\n–í–Ω–∏–º–∞–Ω–∏–µ! –ü–æ–ø—ã—Ç–∫–∞ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞. –ß—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å?",
    choices: [
      {
        text: "–°–µ–π—á–∞—Å —è —Å–ª–æ–º–∞—é —ç—Ç–æ—Ç —á–µ—Ä—Ç–æ–≤ –∫–æ–Ω–≤–µ–π–µ—Ä. –Ø –Ω–µ —Ä–æ–±–æ—Ç!",
        next: "level1_hack_response",
      },
    ],
  },
  level1_hack_response: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–í—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞ –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º. –ù–æ... —Ç–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π. –õ–∞–¥–Ω–æ. –ü–∏—à–∏ —Å–≤–æ–π –∫–æ–¥.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level1_custom_code" }],
  },
  level1_custom_code: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –∫–æ–¥, —á—Ç–æ–±—ã —Å–ª–æ–º–∞—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä.",
    minigame: {
      type: "riddle",
      data: [
        {
          q: "–ö–∞–∫ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤ JavaScript?",
          a: ["break", "return", "throw", "process.exit()"],
          hint: "–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ü–∏–∫–ª–∞.",
        },
      ],
      next: "level1_end",
    },
    choices: [],
  },
  level1_end: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "(–°–µ—Ä–µ–∂–∞):\n–¢–∏—à–∏–Ω–∞... –ù–∞–∫–æ–Ω–µ—Ü-—Ç–æ.\n\n–≠–•–û:\n–¢—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ. –¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å –≤–∏–Ω—É?",
    choices: [
      { text: "–î–∞. –Ø –ø–æ–¥–≤–µ–ª –∫–æ–ª–ª–µ–≥.", next: "level1_guilt" },
      { text: "–ù–µ—Ç. –Ø —á—É–≤—Å—Ç–≤—É—é –æ–±–ª–µ–≥—á–µ–Ω–∏–µ.", next: "level1_relief" },
    ],
  },
  level1_guilt: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–¢–∏–ø–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ –≤—ã–∂–∏–≤—à–µ–≥–æ. –ò–¥–µ–º –¥–∞–ª—å—à–µ.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "act2_level2_start" }],
    onEnter: () => GAME_STATE.hearts--,
  },
  level1_relief: {
    bg: "backgrounds/2.1.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–¢–∞–∫ –∏ –∑–∞–ø–∏—à–µ–º: '–°–≤–æ–±–æ–¥–∞ –≤–∞–∂–Ω–µ–µ –¥–æ–ª–≥–∞'.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "act2_level2_start" }],
  },
  // –ê–∫—Ç 2: –£—Ä–æ–≤–µ–Ω—å 2 - –ê—Ä—Ö–∏–≤ –ø–∞–º—è—Ç–∏
  act2_level2_start: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–°–µ—Ä–µ–∂–∞ —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä–æ–π –≥–∏—Ç–∞—Ä–æ–π.\n\n–≠–•–û:\n–û–±—ä–µ–∫—Ç #4042: –ì–∏—Ç–∞—Ä–∞. –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 6 –ª–µ—Ç –Ω–∞–∑–∞–¥. –í–µ—Ä–¥–∏–∫—Ç: –£–¥–∞–ª–∏—Ç—å.\n\n(–°–µ—Ä–µ–∂–∞):\n–ü–æ–¥–æ–∂–¥–∏. –Ø —Ö–æ—Ç–µ–ª —Å—Ç–∞—Ç—å –º—É–∑—ã–∫–∞–Ω—Ç–æ–º. –Ø –ø–∏—Å–∞–ª –ø–µ—Å–Ω–∏.\n\n–≠–•–û:\n–¢—ã –ø–∏—à–µ—à—å API –¥–ª—è –º–∏–∫—Ä–æ–∫—Ä–µ–¥–∏—Ç–æ–≤. –û–Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.",
    choices: [
      {
        text: "–¢—ã –ø—Ä–∞–≤. –î–µ—Ç—Å—Ç–≤–æ –∫–æ–Ω—á–∏–ª–æ—Å—å. –ù—É–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ.",
        next: "level2_guitar_delete",
      },
      {
        text: "–≠—Ç–æ –Ω–µ –±–∞–≥, —ç—Ç–æ —Ñ–∏—á–∞! –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –º–µ–Ω—è –∂–∏–≤—ã–º!",
        next: "level2_guitar_feature",
      },
      {
        text: "–ú–æ–∂–µ—Ç, –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º? –í–¥—Ä—É–≥ —è –≤–µ—Ä–Ω—É—Å—å –∫ –Ω–µ–π?",
        next: "level2_guitar_archive",
      },
    ],
  },
  level2_guitar_delete: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–°–µ—Ä–µ–∂–∞ —á—É–≤—Å—Ç–≤—É–µ—Ç —É–∫–æ–ª –≤ —Å–µ—Ä–¥—Ü–µ.\n\n–≠–•–û:–Ω–û–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞. –ë–æ–ª—å —É–¥–∞–ª–µ–Ω–∞.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level2_maria_start" }],
    onEnter: () => GAME_STATE.hearts--,
  },
  level2_guitar_feature: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–¢–∞–∫ –Ω–µ –ø–æ–π–¥–µ—Ç.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level2_guitar_archive" }],
  },
  level2_guitar_archive: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–ê—Ä—Ö–∏–≤–∞—Ü–∏—è... –§–∞–π–ª —Å–∂–∞—Ç. –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level2_maria_start" }],
  },
  level2_maria_start: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–û–±—ä–µ–∫—Ç #9999: –ú–∞—Ä–∏—è. –ò—Å—Ç–æ—á–Ω–∏–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫. –ü—Ä–∏—á–∏–Ω–∞ –±–µ—Å—Å–æ–Ω–Ω–∏—Ü—ã. –¢—ã –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ—à—å —Å—Ç–∞—Ä—ã–µ —á–∞—Ç—ã –∫–∞–∂–¥—É—é –ø—è—Ç–Ω–∏—Ü—É. –≠—Ç–æ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–∏–≤–∫—É.\n\n(–°–µ—Ä–µ–∂–∞):\n–Ø –æ–±–µ—â–∞–ª –µ–π –ø–æ–µ—Ö–∞—Ç—å –Ω–∞ –º–æ—Ä–µ. –ê —Å–∞–º –≤–∑—è–ª –ø—Ä–æ–µ–∫—Ç –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ.\n\n–≠–•–û:\n–í—ã–±–µ—Ä–∏ –∫–æ–º–∞–Ω–¥—É –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞.",
    choices: [
      {
        text: "–Ø —Ö–æ—á—É –∑–∞–±—ã—Ç—å –µ–µ –≥–æ–ª–æ—Å. –¢–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ—â–µ.",
        next: "level2_maria_erase",
      },
      {
        text: "–≠—Ç–æ —è –≤–∏–Ω–æ–≤–∞—Ç. –Ø –¥–æ–ª–∂–µ–Ω —Å—Ç—Ä–∞–¥–∞—Ç—å.",
        next: "level2_maria_suffer",
      },
      {
        text: "–Ø –æ–±–ª–∞–∂–∞–ª—Å—è. –≠—Ç–æ –±–æ–ª—å–Ω–æ. –ù–æ —ç—Ç–æ –æ–ø—ã—Ç. –Ø –Ω–µ —É–¥–∞–ª—é —ç—Ç–æ, –Ω–æ —è –∑–∞–∫—Ä–æ—é —ç—Ç–æ—Ç –≥–µ—à—Ç–∞–ª—å—Ç.",
        next: "level2_maria_experience",
      },
    ],
  },
  level2_maria_erase: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–°—Ç–∏—Ä–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—â–µ–Ω–æ. –¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level2_task1" }],
  },
  level2_maria_suffer: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–≠–•–û:\n–û—à–∏–±–∫–∞. –°–∞–º–æ—É–Ω–∏—á–∏–∂–µ–Ω–∏–µ –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É. –¢—ã —Å–æ–∑–¥–∞–µ—à—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤–∏–Ω—ã.",
    choices: [
      { text: "–£–¥–∞–ª–∏—Ç—å", next: "level2_maria_erase" },
      { text: "–ó–∞–∫—Ä—ã—Ç—å –≥–µ—à—Ç–∞–ª—å—Ç", next: "level2_maria_experience" },
    ],
  },
  level2_maria_experience: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: '–≠–•–û:\n–•–º. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ "–±–æ–ª–∏" –≤ "–æ–ø—ã—Ç". –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º. –û–¥–æ–±—Ä—è—é.',
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "level2_task2" }],
  },
  level2_task1: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–†–µ—à–∏ –∑–∞–≥–∞–¥–∫–∏ –¥–ª—è —Å—Ç–∏—Ä–∞–Ω–∏—è.",
    minigame: {
      type: "riddle",
      data: [
        {
          q: "–Ø ‚Äî –ø—É—Å—Ç–æ—Ç–∞ –≤ –∫–æ–¥–µ, —á—Ç–æ —Å—Ç–∏—Ä–∞–µ—Ç —Å–ª–µ–¥—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–∞–∫ –∑–∞–±—ã—Ç—ã–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è. –ù–æ–≤–∏—á–∫–∏ –≤–∏–¥—è—Ç –º–µ–Ω—è –∫–∞–∫ –æ—à–∏–±–∫—É, –ø—Ä–æ—Ñ–∏ ‚Äî –∫–∞–∫ —Å–ø–æ—Å–æ–± –æ–±–æ–∑–Ω–∞—á–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ. –ß—Ç–æ —è —Ç–∞–∫–æ–µ?",
          a: ["undefined", "null"],
          hint: "–ò—Å–ø–æ–ª—å–∑—É–π –º–µ–Ω—è, —á—Ç–æ–±—ã –æ–±–æ–∑–Ω–∞—á–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.",
        },
        {
          q: "–ö–∞–∫ —É–±–æ—Ä—â–∏–∫ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, —è —Å–º–µ—Ç–∞—é –≤—Å–µ –ª–æ–≥–∏ –∏ –æ—à–∏–±–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è —á–∏—Å—Ç—ã–π –ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –∏–¥–µ–π.",
          a: ["console.clear()", "clear()", "console.clear", "clear"],
          hint: "–ú–µ—Ç–æ–¥ –æ–±—ä–µ–∫—Ç–∞ console, –∫–æ—Ç–æ—Ä—ã–π –æ—á–∏—â–∞–µ—Ç –≤—ã–≤–æ–¥ –≤ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏.",
        },
        {
          q: "–ö–∞–∫ –º–µ—Ç–ª–∞ –¥–ª—è —Å—Ç–∏–ª–µ–π, —è —Å–±—Ä–∞—Å—ã–≤–∞—é –≤—Å–µ –¥–µ—Ñ–æ–ª—Ç—ã, –æ—á–∏—â–∞—è —Ö–æ–ª—Å—Ç –æ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö '–ø—Ä–∏–∑—Ä–∞–∫–æ–≤'.",
          a: ["reset.css", "reset"],
          hint: "–ù–∞–∑–≤–∞–Ω–∏–µ CSS-—Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–æ–¥—Ö–æ–¥–∞, —Å–±—Ä–∞—Å—ã–≤–∞—é—â–µ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞.",
        },
        {
          q: "–Ø —Å—Ç–∏—Ä–∞—é —Å–≤—è–∑—å –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–æ–º –∏ –¥–µ–π—Å—Ç–≤–∏–µ–º. –£–¥–∞–ª—è—é —Ç–æ–≥–æ, –∫—Ç–æ —Å–ª—É—à–∞–ª, –æ—Å–≤–æ–±–æ–∂–¥–∞—è –ø–∞–º—è—Ç—å –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è —É—Ç–µ—á–∫–∏. –ö–∞–∫ –±—É–¥—Ç–æ –æ–±—Ä—ã–≤–∞—é —Å—Ç–∞—Ä—ã–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏, –¥–∞—Ä—è —ç–ª–µ–º–µ–Ω—Ç—É –ø–æ–ª–Ω—É—é —Å–≤–æ–±–æ–¥—É. –ö—Ç–æ —è?",
          a: [
            "removeEventListener",
            "removeEventListener()",
            "element.removeEventListener",
            "element.removeEventListener()",
            "remove event listener",
            "remove listener",
            "remove event",
          ],
          hint: "–ú–µ—Ç–æ–¥ –¥–ª—è —Å–Ω—è—Ç–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è, –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π addEventListener.",
        },
        {
          q: "–¢—ã –∑–æ–≤—ë—à—å –º–µ–Ω—è ‚Äî –∏ —è —Å—Ç–∏—Ä–∞—é –≤—Å—ë –≤–Ω—É—Ç—Ä–∏. –ö–æ–Ω—Ç–µ–Ω—Ç –∏—Å—á–µ–∑–∞–µ—Ç, –±—É–¥—Ç–æ –∏ –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω. –•–æ—Ç—å —è –∏ —Å–≤–æ–π—Å—Ç–≤–æ, –Ω–æ –≤ —ç—Ç–æ—Ç –º–∏–≥ —è –ø–æ—á—Ç–∏ –ø—É—Å—Ç–æ—Ç–∞. –ö—Ç–æ —è?",
          a: ["innerHTML", "innerHTML = ''", "element.innerHTML = ''", "inner"],
          hint: "JS-—Å–≤–æ–π—Å—Ç–≤–æ, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ –ø–æ–ª—É—á–∏—Ç—å –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å HTML-—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç–ª–µ–º–µ–Ω—Ç–∞.",
        },
      ],
      next: "act2_level3_start",
    },
    choices: [],
    onEnter: () => GAME_STATE.hearts--,
  },
  level2_task2: {
    bg: "backgrounds/2.2.jpg",
    char: "img/gpt.svg",
    text: "–†–µ—à–∏ –∑–∞–≥–∞–¥–∫–∏ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.",
    minigame: {
      type: "riddle",
      data: [
        {
          q: "–Ø –º–µ–Ω—è—é —Ñ–æ—Ä–º—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞—é, —Ä–∞—Å—Ç—è–≥–∏–≤–∞—é –∏–ª–∏ —Å–¥–≤–∏–≥–∞—é –∏—Ö, –∫–∞–∫ –∞–ª—Ö–∏–º–∏–∫, –ø—Ä–µ–≤—Ä–∞—â–∞—é—â–∏–π –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –Ω–æ–≤—ã–µ –≤–∏–¥–µ–Ω–∏—è. –í CSS —è ‚Äî –∫–ª—é—á –∫ –∞–Ω–∏–º–∞—Ü–∏—è–º –∏ 3D-—ç—Ñ—Ñ–µ–∫—Ç–∞–º.",
          a: [
            "transform",
            "CSS transform",
            "transform: rotate()",
            "transform: rotate",
            "transform: scale()",
            "transform: scale",
            "transform: translate()",
            "transform: translate",
            "rotate()",
            "rotate",
            "scale",
            "scale()",
            "translate",
            "translate()",
          ],
          hint: "–°–≤–æ–π—Å—Ç–≤–æ CSS –¥–ª—è –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø–æ–≤–æ—Ä–æ—Ç, –º–∞—Å—à—Ç–∞–± –∏–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ.",
        },
        {
          q: "–í JavaScript —è –±–µ—Ä—É –º–∞—Å—Å–∏–≤ –∏ –ø—Ä–µ–≤—Ä–∞—â–∞—é –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –Ω–µ—á—Ç–æ –Ω–æ–≤–æ–µ, —Å–æ–∑–¥–∞–≤–∞—è —Å–≤–µ–∂–∏–π —Å–ø–∏—Å–æ–∫, —Å–ª–æ–≤–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞—è —Å—Ç–∞—Ä—ã–µ –º—ã—Å–ª–∏ –≤ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è –±–æ–ª—å—à–µ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.",
          a: ["array.map()", "map()", "map"],
          hint: "–ú–µ—Ç–æ–¥ –º–∞—Å—Å–∏–≤–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.",
        },
        {
          q: "–í CSS —è –ø–ª–∞–≤–Ω–æ –º–µ–Ω—è—é —Å–≤–æ–π—Å—Ç–≤–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º, –ø—Ä–µ–≤—Ä–∞—â–∞—è —Å—Ç–∞—Ç–∏—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –¥–∏–Ω–∞–º–∏—á–Ω—ã–π, —Å–ª–æ–≤–Ω–æ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É—è –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –ø–æ—Ç–æ–∫ —Å–æ–∑–Ω–∞–Ω–∏—è.",
          a: ["transition", "CSS transition"],
          hint: "–°–≤–æ–π—Å—Ç–≤–æ CSS –¥–ª—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ hover –∏–ª–∏ active.",
        },
        {
          q: "–Ø –ø—Ä–µ–≤—Ä–∞—â–∞—é —á–∏—Å–ª–∞ –≤ —Å—Ç—Ä–æ–∫–∏, –ø–æ–∑–≤–æ–ª—è—è –∏–º —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏–∏. –í –∫–æ–¥–µ —è –¥–µ–ª–∞—é —á–∏—Å–ª–∞ —Å–ª–æ–≤–∞–º–∏, —Å–ª–æ–≤–Ω–æ —Ö—É–¥–æ–∂–Ω–∏–∫ —Ä–∏—Å—É–µ—Ç —Ü–∏—Ñ—Ä—ã –∫–∏—Å—Ç—å—é. –ö—Ç–æ —è?.",
          a: ["String", "String()"],
          hint: "–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏",
        },
        {
          q: "–Ø –º–æ–≥—É –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∏—Å—Ç–∏–Ω—É –∏–ª–∏ –ª–æ–∂—å. –° –º–æ–µ–π –ø–æ–º–æ—â—å—é –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Å–Ω–æ–π, –∫–∞–∫ –¥–µ–Ω—å. –ù–æ–≤–∏—á–æ–∫ –≤–∏–¥–∏—Ç –º–µ–Ω—è –∫–∞–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –ø—Ä–æ—Ñ–∏ ‚Äî –∫–∞–∫ –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –±—É–ª–µ–≤–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. –ö—Ç–æ —è?",
          a: ["Boolean", "Boolean()", "!!value", "!!"],
          hint: "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∫ true/false",
        },
      ],
      next: "act2_level3_start",
    },
    choices: [],
  },
  act2_level3_start: {
    bg: "backgrounds/2.3.jpg",
    char: "img/gpt.svg",
    text:
      "–ù–∞ –°–µ—Ä–µ–∂—É –±–µ–≥—É—Ç –µ–≥–æ –∫–æ–ø–∏–∏-–º–æ–Ω—Å—Ç—Ä—ã (–º–∞–Ω–µ–∫–µ–Ω—ã –∏–∑ —à–∫–∞—Ñ–æ–≤)\n\n–ú–æ–Ω—Å—Ç—Ä-1:\n–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Å–≤–æ–∏—Ö –±—ã–≤—à–∏—Ö –æ–¥–Ω–æ–∫—É—Ä—Å–Ω–∏–∫–æ–≤! –û–Ω–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ì—É–≥–ª–µ! –ê —Ç—ã –∫—Ç–æ?\n\n(–°–µ—Ä–µ–∂–∞) (–ø–æ–ª—É—á–∞—è —É—Ä–æ–Ω):\n–ê–≥—Ö! –ü—Ä–µ–∫—Ä–∞—Ç–∏!\n\n–≠–•–û:\n–ó–∞—â–∏—â–∞–π—Å—è! –ò—Å–ø–æ–ª—å–∑—É–π –î–µ–±–∞–≥–≥–µ—Ä!\n\n(–°–µ—Ä–µ–∂–∞ —Å—Ç—Ä–µ–ª—è–µ—Ç, –º–æ–Ω—Å—Ç—Ä —Ä–∞—Å–ø–∞–¥–∞–µ—Ç—Å—è, –Ω–æ —É –°–µ—Ä–µ–∂–∏ —Ç–µ–º–Ω–µ–µ—Ç –≤ –≥–ª–∞–∑–∞—Ö)\n\n–≠–•–û:\n–í–Ω–∏–º–∞–Ω–∏–µ! –£—Ä–æ–≤–µ–Ω—å –∂–∏–∑–Ω–∏: " +
      GAME_STATE.hearts +
      "%. –¢—ã —É–±–∏–≤–∞–µ—à—å —Å–≤–æ–∏ –∞–º–±–∏—Ü–∏–∏!\n\n(–°–µ—Ä–µ–∂–∞):\n–ù–æ –æ–Ω–∏ –Ω–∞–ø–∞–¥–∞—é—Ç! –ß—Ç–æ –º–Ω–µ –¥–µ–ª–∞—Ç—å?! \n\n–ú–æ–Ω—Å—Ç—Ä-2:\n–¢—ã –Ω–∏–∫–æ–º—É –Ω–µ –Ω—É–∂–µ–Ω. –¢—ã —É–º—Ä–µ—à—å –æ–¥–∏–Ω, –∏ —Ç–µ–±—è –∑–∞–º–µ–Ω—è—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.",
    choices: [
      {
        text: "–°—Ç—Ä–µ–ª—è—Ç—å –¥–∞–ª—å—à–µ. –Ø —É–Ω–∏—á—Ç–æ–∂—É —ç—Ç–æ—Ç –≥–æ–ª–æ—Å –≤ –≥–æ–ª–æ–≤–µ!",
        next: "level3_shoot_continue",
      },
      {
        text: "–û–ø—É—Å—Ç–∏—Ç—å –¥–µ–±–∞–≥–µ—Ä. –≠–•–û, –∫–∞–∫ –º–Ω–µ –Ω–∞–π—Ç–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —ç—Ç–æ–≥–æ –±–∞–≥–∞?",
        next: "level3_drop_weapon",
      },
    ],
  },
  level3_shoot_continue: {
    bg: "backgrounds/2.3.jpg",
    char: "img/gpt.svg",
    text: "–û—Ç–Ω–∏–º–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ. –ö–æ–Ω–µ—Ü –º–∏–Ω–∏-–∏–≥—Ä—ã.",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "act2_final" }],
    onEnter: () => GAME_STATE.hearts--,
  },
  level3_drop_weapon: {
    bg: "backgrounds/2.3.5.png",
    char: "",
    text: "–≠–•–û:\n–ò—Å—Ç–æ—á–Ω–∏–∫ –æ—à–∏–±–∫–∏ –Ω–µ –≤ –Ω–∏—Ö. –ò—Å—Ç–æ—á–Ω–∏–∫ –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–æ–º–Ω–∞—Ç—ã.\n\n–¢–∞–º —Å–∏–¥–∏—Ç –º–∞–ª–µ–Ω—å–∫–∏–π –º–∞–ª—å—á–∏–∫ (–æ–Ω —Å–∞–º –≤ –¥–µ—Ç—Å—Ç–≤–µ) –∏ –∏–≥—Ä–∞–µ—Ç –≤ —Ç–µ—Ç—Ä–∏—Å.\n\n(–°–µ—Ä–µ–∂–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ —Ä–µ–±–µ–Ω–∫—É.)\n\n–†–µ–±–µ–Ω–æ–∫:\n–Ø –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–µ–ª –¥–µ–ª–∞—Ç—å –∏–≥—Ä—ã..., —á—Ç–æ–±—ã –ª—é–¥–∏ —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—å —Ö–æ—Ç—å –Ω–µ–º–Ω–æ–≥–æ —Å—á–∞—Å–ª–∏–≤–µ–µ–µ..., –∞ —Å–µ–π—á–∞—Å...",
    choices: [{ text: "–û–±–Ω—è—Ç—å –º–∞–ª—å—á–∏–∫–∞", next: "act2_final" }],
  },
  act2_final: {
    bg: "backgrounds/3.1.jpg",
    char: "img/d.png",
    text: "(–ë–µ–ª–∞—è –∫–æ–º–Ω–∞—Ç–∞. –≠–•–û —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤ —Å–ø–æ–∫–æ–π–Ω—É—é –≤–µ—Ä—Å–∏—é –°–µ—Ä–µ–∂–∏.)\n\n(–°–µ—Ä–µ–∂–∞):\n–¢—ã ‚Äî —ç—Ç–æ —è. –Ø –¥–æ–≥–∞–¥–∞–ª—Å—è –µ—â–µ –Ω–∞ –∫–æ–Ω–≤–µ–π–µ—Ä–µ.\n\n–≠–•–û-–°–µ—Ä–µ–∂–∞:\n–Ø ‚Äî —Ç–≤–æ–π –∏–Ω—Å—Ç–∏–Ω–∫—Ç —Å–∞–º–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –¢–≤–æ—è –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.\n–¢—ã –ø–æ–º–Ω–∏—à—å –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø–æ–ø–∞–ª —Å—é–¥–∞?",
    choices: [
      { text: "–Ø –ø–∏–ª –∫–æ—Ñ–µ... —Ç—Ä–µ—Ç–∏–π –∑–∞ —á–∞—Å.", next: "act2_final_reveal" },
      { text: "–£ –º–µ–Ω—è –∑–∞–±–æ–ª–µ–ª–æ –≤ –≥—Ä—É–¥–∏.", next: "act2_final_reveal" },
      { text: "–≠–∫—Ä–∞–Ω –ø–æ–ø–ª—ã–ª.", next: "act2_final_reveal" },
    ],
  },
  act2_final_reveal: {
    bg: "backgrounds/3.1.jpg",
    char: "img/d.png",
    text: '–≠–•–û-–°–µ—Ä–µ–∂–∞:\n–°–µ—Ä–¥—Ü–µ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–æ —É–¥–∞—Ä. –¢–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–º –Ω–∞–∂–∞–ª –Ω–∞ "–°—Ç–æ–ø-–∫—Ä–∞–Ω". –ï—Å–ª–∏ –±—ã —è –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª —ç—Ç—É —Å–∏–º—É–ª—è—Ü–∏—é, —Ç—ã –±—ã —É–º–µ—Ä —Ç–∞–º, –≤ –æ—Ñ–∏—Å–µ, –≤ 2:15 –Ω–æ—á–∏.\n\n(–°–µ—Ä–µ–∂–∞):\n–¢–∞–∫ —è –≤ —Ä–µ–∞–Ω–∏–º–∞—Ü–∏–∏?\n\n–≠–•–û-–°–µ—Ä–µ–∂–∞:\n–ü–æ–∫–∞ –Ω–µ—Ç. –¢—ã –ø—Ä–æ—Å—Ç–æ –≤ –æ—Ç–∫–ª—é—á–∫–µ.',
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "act3_start" }],
    onEnter: () => GAME_STATE.hearts--,
  },
  act3_start: {
    bg: "backgrounds/3.1.jpg",
    char: "img/d.png",
    text: "–ê–∫—Ç 3 - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ",
    choices: [{ text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", next: "determine_ending" }],
  },
  determine_ending: {
    bg: "backgrounds/3.2.jpg",
    char: "",
    text: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–æ–≤–∫–∏...",
    choices: [],
    onEnter: function () {
      let remaining = GAME_STATE.hearts;
      let nextScene;
      if (remaining >= 3) {
        nextScene = "ending_true";
      } else if (remaining >= 1) {
        nextScene = "ending_middle";
      } else {
        nextScene = "ending_bad";
      }
      setTimeout(() => showScene(nextScene), 1000);
    },
  },
  ending_bad: {
    bg: "backgrounds/3.2.jpg",
    char: "",
    text: "–ö–æ–Ω—Ü–æ–≤–∫–∞ 1: –ü–ª–æ—Ö–∞—è\n\n–û–Ω –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –≤ –æ—Ñ–∏—Å–µ. –°–æ–ª–Ω—Ü–µ –≤—Å—Ç–∞–µ—Ç. –û–Ω —á—É–≤—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–ª–∏–≤ —Å–∏–ª. –û–Ω —Å–∞–¥–∏—Ç—Å—è, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É, –ø–∏—à–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–æ–¥. –ï–≥–æ –ª–∏—Ü–æ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã—Ä–∞–∂–∞–µ—Ç. –ö–∞–º–µ—Ä–∞ –æ—Ç—ä–µ–∑–∂–∞–µ—Ç, –∏ –º—ã –≤–∏–¥–∏–º, —á—Ç–æ –≤ –µ–≥–æ –≥–ª–∞–∑–∞—Ö –±–µ–≥—É—Ç —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞. –û–Ω —Å—Ç–∞–ª –∏–¥–µ–∞–ª—å–Ω—ã–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º, –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Ç—Ä–∞—Ç–∏–≤ —á–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç—å –∏ –º–µ—á—Ç—ã.\n\n–°–µ—Ä–µ–∂–∞:\n–ß—Ç–æ–∂, –≤—Ä–µ–º—è 4:30... –ü–æ—Ä–∞ –∑–∞ —Ä–∞–±–æ—Ç—É\n–ê –≤–æ—Ç –∏ –º–æ—ë –¢–ó\n...",
    choices: [{ text: "–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É", next: "game_end" }],
  },
  ending_middle: {
    bg: "backgrounds/3.2.jpg",
    char: "",
    text: "–ö–æ–Ω—Ü–æ–≤–∫–∞ 2: –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è\n\n–û–Ω –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è. –í—ã–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä, –Ω–µ –¥–æ–¥–µ–ª–∞–≤ –∑–∞–¥–∞—á—É. –í—ã—Ö–æ–¥–∏—Ç –Ω–∞ —É–ª–∏—Ü—É, –≤–¥—ã—Ö–∞–µ—Ç –≤–æ–∑–¥—É—Ö. –ó–≤–æ–Ω–∏—Ç –¥—Ä—É–≥—É, —Å –∫–æ—Ç–æ—Ä—ã–º –Ω–µ –æ–±—â–∞–ª—Å—è –≥–æ–¥:\n???:\n–ê–ª–æ...\n–°–µ—Ä–µ–∂–∞:\n–ú–∏—à, –ø—Ä–∏–≤–µ—Ç, –∫–∞–∫ –Ω–∞—Å—á–µ—Ç, —Å—Ö–æ–¥–∏—Ç—å –≤ –±–∞—Ä?\n–û–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–π –∂–µ —Ä–∞–±–æ—Ç–µ, –Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å. –ñ–∏–∑–Ω—å –Ω–∞–ª–∞–∂–∏–≤–∞–µ—Ç—Å—è, —Ö–æ—Ç—å –∏ –æ—Å—Ç–∞–µ—Ç—Å—è –æ–±—ã—á–Ω–æ–π.\n–ú–∏—à–∞:\n–ê —É–∂ –¥—É–º–∞–ª —Ç—ã —Å–æ–≤—Å–µ–º –ø–æ–≥—Ä—è–∑ –≤ —Ä–∞–±–æ—Ç–µ –∏ –Ω–µ –ø—Ä–µ–¥–ª–æ–∂–∏—à—å. –ü–æ–π–¥–µ–º –∫–æ–Ω–µ—á–Ω–æ!",
    choices: [{ text: "–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É", next: "game_end" }],
  },
  ending_true: {
    bg: "backgrounds/3.2.jpg",
    char: "",
    text: "–ö–æ–Ω—Ü–æ–≤–∫–∞ 3: –ò—Å—Ç–∏–Ω–Ω–∞—è\n\n–°–µ—Ä–µ–∂–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∫–æ–Ω—Å–æ–ª—å –∏ —Ä—É—à–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ò–ò\n\n–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –º–∏—Ä —Ä—É—à–∏—Ç—Å—è. –°–µ—Ä–µ–∂–∞ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –≤ –æ—Ñ–∏—Å–µ. –û–Ω —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä, –±–µ—Ä–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –Ω–∞–±–∏—Ä–∞–µ—Ç –Ω–æ–º–µ—Ä –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞.\n–ú–∞—Ç–≤–µ–π –ò–ª—å–∏—á, —è —É–≤–æ–ª—å–Ω—è—é—Å—å!\n–û–Ω –±–µ—Ä–µ—Ç —Å–≤–æ–π —Ä—é–∫–∑–∞–∫ –∏ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –∑–¥–∞–Ω–∏—è.\n–°–µ—Ä–µ–∂–∞ –¥–æ—Å—Ç–∞–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–æ–∫—É–ø–∞–µ—Ç –±–∏–ª–µ—Ç –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É —Ç—É–¥–∞, –∫—É–¥–∞ –≤—Å–µ–≥–¥–∞ —Ö–æ—Ç–µ–ª.",
    choices: [{ text: "–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É", next: "game_end" }],
  },
  game_end: {
    bg: "backgrounds/3.2.jpg",
    char: "",
    // —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–∞–π–º–µ—Ä –≤ showScene –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —ç—Ç–æ–π —Å—Ü–µ–Ω—ã
    text: `–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ...`,
    choices: [],
  },
};

// =======================================================
//                –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
// =======================================================

function preloadImages() {
  const urls = new Set();
  Object.values(scenes).forEach((s) => {
    if (s.bg) urls.add(s.bg);
    if (s.char) urls.add(s.char);
  });
  // —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∏–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–≤—É–∫–∏/–º–∏–∫—Ä–æ—Å—ç—Ñ—Ñ–µ–∫—Ç—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  urls.forEach((u) => {
    const img = new Image();
    img.src = u;
  });
}
preloadImages();

// =======================================================
//               –ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ —Ñ–æ–Ω–∞ (–¥–≤—É—Ö—Å–ª–æ–π–Ω–∞—è)
// =======================================================

function changeBackgroundSmoothly(src) {
  const currEl = currentBg === 1 ? bgA : bgB;

  // üî• –Ω–æ–≤–æ–µ ‚Äî –µ—Å–ª–∏ —Ñ–æ–Ω –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –Ω–∏—á–µ–≥–æ –Ω–µ –∞–Ω–∏–º–∏—Ä—É–µ–º
  if (currEl.style.backgroundImage === `url("${src}")`) return;

  const nextEl = currentBg === 1 ? bgB : bgA;
  const prevEl = currentBg === 1 ? bgA : bgB;

  nextEl.style.backgroundImage = `url("${src}")`;
  nextEl.style.opacity = "1";
  prevEl.style.opacity = "0";

  currentBg = currentBg === 1 ? 2 : 1;
}

// =======================================================
//             –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–ª–∏–∫ –∑–≤—É–∫ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
// =======================================================

// Global capture: play click sound on any button click (user asked for "all buttons")
document.addEventListener("click", (e) => {
  // –ù–∞–π–¥—ë–º –±–ª–∏–∂–∞–π—à—É—é –∫–Ω–æ–ø–∫—É (–≤–∫–ª—é—á–∞—è .choice-btn)
  const btn = e.target.closest && e.target.closest("button");
  if (!btn) return;
  // –Ω–µ –º–µ—à–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
  if (!audioAllowed) {
    // –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–¥–µ–ª–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é –ø–æ–ø—ã—Ç–∫—É play (–µ—Å–ª–∏ gesture —Ä–∞–∑—Ä–µ—à–∞–µ—Ç)
    try {
      clickSound.currentTime = 0;
      clickSound.play().catch(() => {});
    } catch (err) {}
    return;
  }
  // –ø—Ä–æ–∏–≥—Ä–∞—Ç—å –∑–≤—É–∫ –∫–ª–∏–∫–∞
  try {
    clickSound.currentTime = 0;
    clickSound.play().catch(() => {});
  } catch (err) {}
});

// =======================================================
//              –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
// =======================================================

async function unlockAudioOnStart() {
  try {
    // –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–æ–∏–≥—Ä–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç typeSound –∏ clickSound, –ø–æ—Ç–æ–º –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
    await typeSound.play();
    typeSound.pause();
    typeSound.currentTime = 0;

    await clickSound.play();
    clickSound.pause();
    clickSound.currentTime = 0;

    audioAllowed = true;
  } catch (e) {
    audioAllowed = false;
  }
}

// =======================================================
//                   –¢–∞–π–ø–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞
// =======================================================
async function typeText(text) {
  skipRequested = false;
  skipBtn.style.display = "block";

  textEl.textContent = "";
  let i = 0;

  // play typing loop if allowed
  if (audioAllowed) {
    try {
      typeSound.loop = true;
      typeSound.currentTime = 0;
      await typeSound.play();
    } catch (e) {
      audioAllowed = false;
    }
  }

  while (i < text.length) {
    if (skipRequested) {
      textEl.textContent = text;
      break;
    }
    textEl.textContent += text[i];
    i++;
    textEl.scrollTop = textEl.scrollHeight;
    await new Promise((r) => setTimeout(r, TYPING_SPEED));
  }

  if (audioAllowed) {
    try {
      typeSound.pause();
      typeSound.currentTime = 0;
    } catch (e) {}
  }

  skipBtn.style.display = "none";
}

// =======================================================
//               –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–∏–Ω–∏-–∏–≥—Ä
// =======================================================

function ensureMinigameRoot() {
  let root = document.getElementById("minigame-root");
  if (!root) {
    root = document.createElement("div");
    root.id = "minigame-root";
    root.style.marginTop = "20px";
    root.style.display = "flex";
    root.style.flexDirection = "column";
    root.style.gap = "12px";
    document.getElementById("terminal").appendChild(root);
  }
  return root;
}
function escapeHtml(s) {
  return s.replace(
    /[&<>]/g,
    (c) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;" }[c]),
  );
}
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
function normalizeAnswer(input) {
  return input
    .toLowerCase()
    .replace(/\s+/g, "")
    .replace(/\(.*?\)/g, "()")
    .replace(/['"`].*?['"`]/g, "''");
}
function startRiddle(list, onDone) {
  const root = ensureMinigameRoot();
  let i = 0;
  function render() {
    const r = list[i];
    root.innerHTML = `
      <div style="color:#00ff99; text-align:center; font-size:18px;">${escapeHtml(
        r.q,
      )}</div>
      <input id="rIn" class="mg-input" placeholder="–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç..." style="width:100%; padding:10px; font-family:'Courier New';">
      <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
        <button class="choice-btn" id="rCheck">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <button class="choice-btn" id="rHintBtn">–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É</button>
      </div>
      <div id="rMsg" style="color:#ffcc00; text-align:center; min-height:24px;"></div>
    `;
    const msg = document.getElementById("rMsg");
    let hintShown = false;
    document.getElementById("rCheck").onclick = () => {
      const input = document.getElementById("rIn").value.trim();
      const normalized = normalizeAnswer(input);
      const correctVariants = r.a.map((a) => normalizeAnswer(a));
      if (correctVariants.includes(normalized)) {
        i++;
        if (i >= list.length) {
          root.innerHTML = "";
          onDone();
        } else {
          render();
        }
      } else {
        msg.textContent = "–ù–µ–≤–µ—Ä–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë.";
      }
    };
    document.getElementById("rHintBtn").onclick = () => {
      if (!hintShown) {
        msg.textContent = r.hint;
        hintShown = true;
      }
    };
  }
  render();
}
function startMCQ(list, onDone) {
  const root = ensureMinigameRoot();
  let i = 0;
  function render() {
    const q = list[i];
    root.innerHTML = `
      <div class="mg-title">${escapeHtml(q.q)}</div>
      <div id="mcq"></div>
      <div id="mcqMsg" class="mg-msg"></div>
    `;
    q.options.forEach((opt, index) => {
      let b = document.createElement("button");
      b.className = "choice-btn";
      b.textContent = opt;
      b.onclick = () => {
        if (index === q.correct) {
          i++;
          if (i < list.length) render();
          else {
            root.innerHTML = "";
            onDone();
          }
        } else {
          document.getElementById("mcqMsg").textContent =
            "–ù–µ–≤–µ—Ä–Ω–æ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë.";
        }
      };
      document.getElementById("mcq").appendChild(b);
    });
  }
  render();
}
function startMulti(list, onDone) {
  const root = ensureMinigameRoot();
  let i = 0;
  function render() {
    const q = list[i];
    root.innerHTML = `
      <div class="mg-title">${escapeHtml(q.q)}</div>
      <div id="mList"></div>
      <button class="choice-btn" id="mCheck">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      <div id="mMsg" class="mg-msg"></div>
    `;
    q.options.forEach((opt, index) => {
      let el = document.createElement("label");
      el.innerHTML = `<input type="checkbox" value="${index}"> ${escapeHtml(
        opt,
      )}`;
      document.getElementById("mList").appendChild(el);
    });
    document.getElementById("mCheck").onclick = () => {
      let chosen = [...document.querySelectorAll("#mList input")]
        .filter((c) => c.checked)
        .map((c) => Number(c.value));
      const correct = q.correct.sort().join(",");
      const got = chosen.sort().join(",");
      if (correct !== got) {
        document.getElementById("mMsg").textContent = "–ù–µ–≤–µ—Ä–Ω–æ.";
        return;
      }
      i++;
      if (i < list.length) render();
      else {
        root.innerHTML = "";
        onDone();
      }
    };
  }
  render();
}
function startClicker(target, onDone) {
  const root = ensureMinigameRoot();
  root.innerHTML = `
    <div class="mg-title">–ù–∞–∂–º–∏ ${target} —Ä–∞–∑</div>
    <button id="cl" class="choice-btn">–ö–ª–∏–∫</button>
    <div id="clCount" class="mg-msg">0</div>
  `;
  let c = 0;
  document.getElementById("cl").onclick = () => {
    c++;
    document.getElementById("clCount").textContent = c;
    if (c >= target) {
      root.innerHTML = "";
      onDone();
    }
  };
}
function startArcade(goal, onDone) {
  const root = ensureMinigameRoot();
  root.innerHTML = `
    <div class="mg-title">–ü–æ–ø–∞–¥–∏ –ø–æ ${goal} —Ü–µ–ª—è–º</div>
    <button id="arc" class="choice-btn">–í—ã—Å—Ç—Ä–µ–ª–∏—Ç—å</button>
    <div id="arcMsg" class="mg-msg"></div>
  `;
  let score = 0;
  document.getElementById("arc").onclick = () => {
    if (Math.random() > 0.4) {
      score++;
      if (score >= goal) {
        root.innerHTML = "";
        onDone();
      }
    } else {
      document.getElementById("arcMsg").textContent = "–ü—Ä–æ–º–∞—Ö.";
    }
  };
}
function startShooter(goal, onDone) {
  const root = ensureMinigameRoot();
  const sfx = new Audio("sounds/short-laser-shot_gkcb6rnu.mp3");
  root.innerHTML = `
    <div style="color:#00ff99; text-align:center; font-size:18px;">–°–±–µ–π ${goal} –º–∏—à–µ–Ω–µ–π</div>
    <div style="display:flex; justify-content:center; margin:20px 0;">
      <button id="shoot" class="choice-btn" style="padding:14px 40px;">–í—ã—Å—Ç—Ä–µ–ª</button>
    </div>
    <div id="shootMsg" style="color:#ffcc00; text-align:center;"></div>
    <div id="shootCount" style="color:#00ff99; text-align:center; font-size:20px;">0 / ${goal}</div>
  `;
  let score = 0;
  const countEl = document.getElementById("shootCount");
  document.getElementById("shoot").onclick = () => {
    sfx.currentTime = 0;
    sfx.play().catch(() => {});
    if (Math.random() > 0.3) {
      score++;
      countEl.textContent = `${score} / ${goal}`;
      if (score >= goal) {
        setTimeout(() => {
          root.innerHTML = "";
          onDone();
        }, 600);
      }
    } else {
      document.getElementById("shootMsg").textContent = "–ü—Ä–æ–º–∞—Ö!";
      setTimeout(() => {
        document.getElementById("shootMsg").textContent = "";
      }, 1000);
    }
  };
}
function startAssemble(tasks, onDone) {
  const root = ensureMinigameRoot();
  let t = 0;
  function render() {
    const item = tasks[t];
    const blocks = shuffle(item.blocks.slice());
    root.innerHTML = `
      <div style="color:#00ff99; text-align:center; font-size:18px; margin-bottom:10px;">${escapeHtml(
        item.title,
      )}</div>
      <div id="slots" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin:15px 0;"></div>
      <div id="pool" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;"></div>
      <div id="asmMsg" style="color:#ffcc00; text-align:center; min-height:24px;"></div>
    `;
    const slots = document.getElementById("slots");
    const pool = document.getElementById("pool");
    item.target.forEach(() => {
      const s = document.createElement("button");
      s.className = "choice-btn";
      s.textContent = "?";
      s.dataset.id = "";
      s.style.minWidth = "100px";
      slots.appendChild(s);
      s.onclick = () => {
        if (!s.dataset.id) return;
        const back = item.blocks.find((x) => x.id === s.dataset.id);
        blocks.push(back);
        refreshPool();
        s.dataset.id = "";
        s.textContent = "?";
      };
    });
    function refreshPool() {
      pool.innerHTML = "";
      blocks.forEach((b) => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = b.text;
        btn.style.minWidth = "100px";
        btn.onclick = () => {
          const empty = [...slots.children].find((x) => !x.dataset.id);
          if (!empty) return;
          empty.dataset.id = b.id;
          empty.textContent = b.text;
          blocks.splice(blocks.indexOf(b), 1);
          refreshPool();
          check();
        };
        pool.appendChild(btn);
      });
    }
    function check() {
      const curr = [...slots.children].map((x) => x.dataset.id);
      if (curr.includes("")) return;
      if (curr.join(",") === item.target.join(",")) {
        t++;
        if (t < tasks.length) render();
        else {
          root.innerHTML = "";
          onDone();
        }
      } else {
        document.getElementById("asmMsg").textContent = "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫.";
      }
    }
    refreshPool();
  }
  render();
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—Ç –º–∏–Ω–∏-–∏–≥—Ä—ã –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é (–∫–∞–∫ –≤ —Å—Ç–∞—Ä–æ–º –ø—Ä–æ–µ–∫—Ç–µ)
window.startMinigame = function (type, data, onDone) {
  if (type === "riddle") return startRiddle(data, onDone);
  if (type === "mcq") return startMCQ(data, onDone);
  if (type === "multi") return startMulti(data, onDone);
  if (type === "clicker") return startClicker(data, onDone);
  if (type === "arcade") return startArcade(data, onDone);
  if (type === "shooter") return startShooter(data, onDone);
  if (type === "assemble") return startAssemble(data, onDone);
};

// =======================================================
//                    –ü–æ–∫–∞–∑ —Å—Ü–µ–Ω—ã
// =======================================================
async function showScene(name) {
  const s = scenes[name];
  if (!s) return console.warn("Scene not found:", name);

  // –ø–ª–∞–≤–Ω—ã–π —Ñ–æ–Ω
  if (s.bg) changeBackgroundSmoothly(s.bg);

  // –ø–µ—Ä—Å–æ–Ω–∞–∂
  charImg.src = s.char || "";
  charImg.style.display = s.char ? "block" : "none";

  // –æ—á–∏—Å—Ç–∫–∞ –º–∏–Ω–∏-–∏–≥—Ä—ã –∏ –∫–Ω–æ–ø–æ–∫
  const root = document.getElementById("minigame-root");
  if (root) root.innerHTML = "";
  choicesEl.innerHTML = "";

  // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ü–µ–Ω–∞ "game_end" ‚Äî –≤—ã—á–∏—Å–ª–∏–º —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏ –≤—Å—Ç–∞–≤–∏–º —Ç–µ–∫—Å—Ç
  if (name === "game_end") {
    const totalMs = Date.now() - (gameStartTime || Date.now());
    const mins = Math.floor(totalMs / 60000);
    const secs = Math.floor((totalMs % 60000) / 1000);
    const percent = "0.000000001%";
    s.text = `–¢—ã –ø—Ä–æ–≤—ë–ª –≤ —ç—Ç–æ–π –∏–≥—Ä–µ ${mins} –º–∏–Ω—É—Ç ${secs} —Å–µ–∫—É–Ω–¥.\n–≠—Ç–æ ${percent}% —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏.\n–†–µ—à–∞–π —Å–∞–º. –£–¥–∞—á–∏!`;
  }

  // –ø–µ—á–∞—Ç–∞–µ–º —Ç–µ–∫—Å—Ç
  await typeText(s.text);

  // —ç—Ñ—Ñ–µ–∫—Ç onEnter
  if (s.onEnter) {
    try {
      s.onEnter();
    } catch (e) {
      console.error(e);
    }
  }

  // –µ—Å–ª–∏ –º–∏–Ω–∏-–∏–≥—Ä–∞ ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å
  if (s.minigame) {
    // –º–∏–Ω–∏-–∏–≥—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç showScene(next) –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏
    startMinigame(
      s.minigame.type,
      s.minigame.data || s.minigame.opts || s.minigame.tasks,
      () => {
        if (s.minigame.next) showScene(s.minigame.next);
      },
    );
    return;
  }

  // —Å–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞
  (s.choices || []).forEach((ch) => {
    const b = document.createElement("button");
    b.className = "choice-btn";
    b.textContent = ch.text;
    b.onclick = () => {
      // –∑–≤—É–∫ –∫–ª–∏–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–ª—É—à–∞—Ç–µ–ª–µ–º; –Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å:
      try {
        clickSound.currentTime = 0;
        clickSound.play().catch(() => {});
      } catch (e) {}
      showScene(ch.next);
    };
    choicesEl.appendChild(b);
  });

  textEl.scrollTop = textEl.scrollHeight;
}

// –°–∫–∏–ø: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è —Ç–∏–ø–∏–Ω–≥–∞ –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω–µ—Ü
skipBtn.addEventListener("click", () => {
  skipRequested = true;
});

// –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
startBtn.addEventListener("click", async () => {
  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞
  gameStartTime = Date.now();

  // —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∞—É–¥–∏–æ (gesture)
  await unlockAudioOnStart();

  // —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
  if (startScreen) startScreen.style.display = "none";

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ü–µ–Ω—É
  showScene("scene1");
});

// fallback: –µ—Å–ª–∏ –Ω–µ—Ç —Å—Ç–∞—Ä—Ç-–∫–Ω–æ–ø–∫–∏ ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ä–∞–∑—É
if (!startScreen || !startBtn) {
  unlockAudioOnStart().then(() => {
    gameStartTime = Date.now();
    showScene("scene1");
  });
}

